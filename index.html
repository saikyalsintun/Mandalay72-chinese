<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>è¯æ±‡åº”ç”¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
      background-color: #f4f4f4;
      color: #333;
      text-align: center;
    }
    body.dark {
      background-color: #121212;
      color: #e0e0e0;
    }
    h1 { margin-bottom: 20px; }
    button, select, input {
      padding: 8px 12px;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 1em;
    }
    body.dark button, body.dark select, body.dark input {
      background-color: #333;
      color: #e0e0e0;
      border: 1px solid #555;
    }
    button { cursor: pointer; }
    .tabs { display: flex; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
    .tab { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background-color: #ccc; }
    .tab.active { background-color: #1e88e5; color: white; }
    body.dark .tab.active { background-color: #90caf9; color: black; }
    .section { display: none; width: 100%; max-width: 600px; flex-direction: column; align-items: center; }
    .section.active { display: flex; }
    .word { font-size: 2em; margin: 20px 0; color: #1e88e5; }
    body.dark .word { color: #90caf9; }
    .status { margin-top: 15px; font-weight: bold; font-size: 1.1em; }
    .progress { margin-top: 10px; font-weight: bold; }
    .error-table { margin: 20px 0; border-collapse: collapse; width: 100%; }
    .error-table th, .error-table td { border: 1px solid #ccc; padding: 8px; }
    body.dark .error-table th, body.dark .error-table td { border: 1px solid #555; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    body.dark th, body.dark td { border: 1px solid #555; }
    @media(max-width: 600px){
      .word { font-size: 1.5em; }
      button, select, input { font-size: 0.9em; width: 90%; max-width: 300px; }
      .tabs { flex-direction: column; }
    }
  </style>
</head>
<body>

<h1>è¯æ±‡åº”ç”¨</h1>
<button onclick="toggleDarkMode()">äº®å…‰|æ·±é»‘</button>

<div class="tabs">
  <button class="tab active" onclick="showSection('test')">æµ‹è¯•</button>
  <button class="tab" onclick="showSection('list')">è¯æ±‡è¡¨</button>
</div>

<!-- Test Section -->
<div id="test" class="section active">
  <div>
    <label for="chapterSelect">é€‰æ‹©è¯¾é¢˜:</label>
    <select id="chapterSelect" onchange="selectChapter()">
      <option value="">--é€‰æ‹©--</option>
    </select>
  </div>
  <div class="word" id="word"></div>
  <input type="text" id="answer" placeholder="Type Chinese here">
  <button onclick="checkAnswer()">æäº¤</button>
  <div class="status" id="status"></div>
  <div class="progress" id="progress"></div>

  <table class="error-table" id="errorTable">
    <thead>
      <tr>
        <th>è‹±è¯­</th>
        <th>ä½ å›ç­”</th>
        <th>æ­£ç¡®ç­”æ¡ˆ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- List Section -->
<div id="list" class="section">
  <div>
    <label for="vocabChapterSelect">é€‰æ‹©è¯¾é¢˜:</label>
    <select id="vocabChapterSelect" onchange="showVocab()">
      <option value="">--é€‰æ‹©--</option>
    </select>
  </div>
  <table>
    <thead>
      <tr>
        <th>ä¸­æ–‡</th>
        <th>æ„ä¹‰</th>
      </tr>
    </thead>
    <tbody id="vocabTableBody"></tbody>
  </table>
  <div id="wordCount" style="margin-top: 10px; font-weight: bold;"></div>
</div>

<script>
let vocabData = {};
let currentChapter = [];
let remainingWords = [];
let current = {};
const errors = [];
let completedCount = 0;

const chapterSelect = document.getElementById('chapterSelect');
const wordDiv = document.getElementById('word');
const statusDiv = document.getElementById('status');
const answerInput = document.getElementById('answer');
const errorTableBody = document.querySelector('#errorTable tbody');
const progressDiv = document.getElementById('progress');

const vocabChapterSelect = document.getElementById('vocabChapterSelect');
const vocabTableBody = document.getElementById('vocabTableBody');
const wordCountDiv = document.getElementById('wordCount');

fetch('vocab.json')
  .then(res => res.json())
  .then(data => {
    vocabData = data;
    for (let chapter in vocabData) {
      const option1 = document.createElement('option');
      option1.value = chapter;
      option1.textContent = chapter;
      chapterSelect.appendChild(option1);

      const option2 = document.createElement('option');
      option2.value = chapter;
      option2.textContent = chapter;
      vocabChapterSelect.appendChild(option2);
    }
  })
  .catch(err => console.error("Error loading JSON:", err));

function showSection(sectionId){
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(sectionId).classList.add('active');
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
}

function toggleDarkMode() {
  document.body.classList.toggle('dark');
}

// Test functions
function selectChapter() {
  const selected = chapterSelect.value;
  if (!selected) return;
  currentChapter = vocabData[selected];
  remainingWords = [...currentChapter]; // clone array for random order
  completedCount = 0;
  errors.length = 0;
  updateProgress();
  updateErrorTable();
  showRandomWord();
}

function showRandomWord() {
  if (remainingWords.length === 0) {
    wordDiv.textContent = "å…¨éƒ¨é—®é¢˜éƒ½ç­”å®Œæ¯• ğŸ‰";
    answerInput.value = '';
    statusDiv.textContent = '';
    return;
  }
  const randomIndex = Math.floor(Math.random() * remainingWords.length);
  current = remainingWords[randomIndex];
  wordDiv.textContent = current.B;
  answerInput.value = '';
  statusDiv.textContent = '';
}

function checkAnswer() {
  if (!current.A) return; // no current word
  const userInput = answerInput.value.trim();
  if (!userInput) {
    statusDiv.textContent = "âš ï¸ è¯·æ‰“å­—ä½ çš„å›ç­”!";
    return;
  }
  const correctAnswer = current.A.trim();
  if (userInput === correctAnswer) {
    statusDiv.textContent = "âœ… æ­£ç¡®!";
  } else {
    statusDiv.textContent = `âŒ é”™! æ­£ç¡®ç­”æ¡ˆ: ${correctAnswer}`;
    errors.push({english: current.B, your: userInput, correct: correctAnswer});
  }
  completedCount++;
  // Remove answered word from remaining
  remainingWords = remainingWords.filter(w => w !== current);
  updateProgress();
  updateErrorTable();
  setTimeout(showRandomWord, 1000);
}

function updateErrorTable() {
  errorTableBody.innerHTML = '';
  errors.forEach(err => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${err.english}</td><td>${err.your}</td><td>${err.correct}</td>`;
    errorTableBody.appendChild(row);
  });
}

function updateProgress() {
  if (currentChapter && currentChapter.length > 0) {
    progressDiv.textContent = `å·²å®Œæˆ ${completedCount} / ${currentChapter.length} ä¸ªå•è¯`;
  } else {
    progressDiv.textContent = '';
  }
}

// Vocabulary List
function showVocab() {
  const chapter = vocabChapterSelect.value;
  vocabTableBody.innerHTML = '';
  wordCountDiv.textContent = '';
  if (!chapter || !vocabData[chapter]) return;

  const words = vocabData[chapter];
  words.forEach(w => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${w.A}</td><td>${w.B}</td>`;
    vocabTableBody.appendChild(row);
  });
  wordCountDiv.textContent = `æ€»è¯æ±‡æ•°: ${words.length}`;
}
</script>
</body>
</html>
